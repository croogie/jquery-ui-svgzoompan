/*! jquery-ui-svgzoompan - v0.0.3 - 2014-05-30
* https://github.com/croogie/jquery-ui-svgzoompan
* Copyright (c) 2014 Michał Świtoń; Licensed MIT */
!function(a){a.widget("croogie.svgzoompan",{masterViewBox:[],zoomLevels:[],viewBoxDims:[],curZoomIndex:0,mouseTouchEvent:!1,startX:null,startY:null,options:{zoomLevels:"200, 300, 400, 500, 600, 700, 800, 900, 1000",initialZoom:"100",initialMinX:!1,initialMinY:!1},_setZoomLevels:function(){this.zoomLevels=this.options.zoomLevels.split(", "),this.zoomLevels.push(this.options.initialZoom),this.zoomLevels.sort(function(a,b){return a-b}),this.viewBoxDims=[];for(var a=0;a<this.zoomLevels.length;a++){var b=this.masterViewBox[2]/(this.zoomLevels[a]/100),c=this.masterViewBox[3]/(this.zoomLevels[a]/100);if(this.viewBoxDims[a]={width:b,height:c},this.zoomLevels[a]===this.options.initialZoom){this.curZoomIndex=a;var d=(this.masterViewBox[2]-b)/2,e=(this.masterViewBox[3]-c)/2;this.element.attr("viewBox",d+" "+e+" "+b+" "+c)}}},_registerEvents:function(){this._on(this.element,{mousewheel:"_handleWheelEvent",mousedown:"_handleMouseDownEvent",touchstart:"_handleMouseDownEvent",mouseup:"_handleMouseUpEvent",touchend:"_handleMouseUpEvent",mousemove:"_handleDragEvent",touchmove:"_handleDragEvent"})},_handleWheelEvent:function(a){this.zoom(a.originalEvent.wheelDelta/120>0?"in":"out")},_handleMouseDownEvent:function(a){this.element.data("p0",{x:a.pageX,y:a.pageY}),this.mouseTouchEvent=!0,this._trigger("dragstart"),a.touches?(this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY):(this.startX=a.clientX,this.startY=a.clientY)},_handleMouseUpEvent:function(a){var b=this.element.data("p0"),c={x:a.pageX,y:a.pageY},d=Math.sqrt(Math.pow(c.x-b.x,2)+Math.pow(c.y-b.y,2));this.mouseTouchEvent=!1,d>3&&(a.preventDefault(),a.stopPropagation(),this._trigger("dragend"))},_handleDragEvent:function(a){if(this.mouseTouchEvent){a.preventDefault(),a.stopPropagation();var b,c,d=this._getViewBox();a.touches?(b=this.startX-a.touches[0].clientX,c=this.startY-a.touches[0].clientY):(b=this.startX-a.clientX,c=this.startY-a.clientY),0>b&&d[0]<0?b=0:b>0&&parseInt(d[2])+parseInt(d[0])>this.masterViewBox[2]?b=0:0>c&&d[1]<0?c=0:c>0&&parseInt(d[3])+parseInt(d[1])>this.masterViewBox[3]&&(c=0);var e=this.element.width()/this.masterViewBox[2]/(this.zoomLevels[this.curZoomIndex]/100/1.3),f=this.element.height()/this.masterViewBox[3]/(this.zoomLevels[this.curZoomIndex]/100/1.3),g=parseFloat(d[0])+b*e;0>g&&(g=0);var h=parseFloat(d[1])+c*f;0>h&&(h=0),this.element.get(0).setAttribute("viewBox",g+" "+h+" "+d[2]+" "+d[3]),this._trigger("drag"),a.touches?(this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY):(this.startX=a.clientX,this.startY=a.clientY)}},_getViewBox:function(){return this.element.get(0).getAttribute("viewBox").split(" ")},_create:function(){this.masterViewBox=this._getViewBox(),this._setZoomLevels(),this._registerEvents()},zoom:function(a){a=a.toLowerCase();var b=this._getViewBox();if(this._trigger("beforezoom",null,{zoomLevel:this.zoomLevels[this.curZoomIndex],x:parseFloat(b[0]),y:parseFloat(b[1]),width:parseFloat(b[2]),height:parseFloat(b[3]),direction:a}),"in"===a&&this.curZoomIndex===this.zoomLevels.length-1)return!1;if("out"===a&&0===this.curZoomIndex)return!1;"in"===a?this.curZoomIndex++:this.curZoomIndex--;var c=this.viewBoxDims[this.curZoomIndex],d=parseFloat(b[0])+parseFloat((parseFloat(b[2])-parseFloat(c.width))/2);0>d?d=0:d+parseFloat(c.width)>parseFloat(this.masterViewBox[2])&&(d=parseFloat(this.masterViewBox[2])-parseFloat(c.width));var e=parseFloat(b[1])+parseFloat((parseFloat(b[3])-parseFloat(c.height))/2);return 0>e?e=0:e+parseFloat(c.height)>parseFloat(this.masterViewBox[3])&&(e=parseFloat(this.masterViewBox[3])-parseFloat(c.height)),this.element.get(0).setAttribute("viewBox",d+" "+e+" "+c.width+" "+c.height),this._trigger("afterzoom",null,{zoomLevel:this.zoomLevels[this.curZoomIndex],x:d,y:e,width:c.width,height:c.height,direction:a}),this}})}(jQuery);