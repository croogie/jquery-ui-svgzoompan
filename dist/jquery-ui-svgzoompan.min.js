/*! jquery-ui-svgzoompan - v0.0.5 - 2014-06-05
* https://github.com/croogie/jquery-ui-svgzoompan
* Copyright (c) 2014 Michał Świtoń; Licensed MIT */
!function(a,b){a.widget("croogie.svgzoompan",{masterViewBox:[],zoomLevels:[],viewBoxDims:[],curZoomIndex:0,mouseTouchEvent:!1,startX:null,startY:null,flag:0,options:{zoomLevels:"200, 300, 400, 500, 600, 700, 800, 900, 1000",initialZoom:"100",initialMinX:!1,initialMinY:!1},_registerEvents:function(){this._on(this.element,{mousewheel:"_handleWheelEvent",mousedown:"_handleMouseDownEvent",touchstart:"_handleMouseDownEvent",mouseup:"_handleMouseUpEvent",touchend:"_handleMouseUpEvent",mousemove:"_handleDragEvent",touchmove:"_handleDragEvent"})},_setZoomLevels:function(){this.zoomLevels=this.options.zoomLevels.split(", "),this.zoomLevels.push(this.options.initialZoom),this.zoomLevels.sort(function(a,b){return a-b}),this.viewBoxDims=[];for(var a=0;a<this.zoomLevels.length;a++){var b=this.masterViewBox[2]/(this.zoomLevels[a]/100),c=this.masterViewBox[3]/(this.zoomLevels[a]/100);if(this.viewBoxDims[a]={width:b,height:c},this.zoomLevels[a]===this.options.initialZoom){this.curZoomIndex=a;var d=(this.masterViewBox[2]-b)/2,e=(this.masterViewBox[3]-c)/2;this.element.attr("viewBox",d+" "+e+" "+b+" "+c)}}},_handleWheelEvent:function(a,b){this.zoom(b>0?"in":"out")},_handleMouseDownEvent:function(a){this.flag=1,a.stopPropagation(),a.preventDefault(),a.touches?(this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY):(this.startX=a.clientX,this.startY=a.clientY)},_handleMouseUpEvent:function(a){2===this.flag?(a.preventDefault(),a.stopPropagation(),this._trigger("dragend")):this._trigger("click"),this.flag=0},_handleDragEvent:function(a){if(1===this.flag&&(this._trigger("dragstart"),this.flag=2),2===this.flag){a.preventDefault(),a.stopPropagation();var b,c,d=this._getViewBox();a.touches?(b=this.startX-a.touches[0].clientX,c=this.startY-a.touches[0].clientY):(b=this.startX-a.clientX,c=this.startY-a.clientY),0>b&&d[0]<0?b=0:b>0&&parseInt(d[2])+parseInt(d[0])>this.masterViewBox[2]?b=0:0>c&&d[1]<0?c=0:c>0&&parseInt(d[3])+parseInt(d[1])>this.masterViewBox[3]&&(c=0);var e=this.element.width()/this.masterViewBox[2]/(this.zoomLevels[this.curZoomIndex]/100/1.3),f=this.element.height()/this.masterViewBox[3]/(this.zoomLevels[this.curZoomIndex]/100/1.3),g=parseFloat(d[0])+b*e;0>g&&(g=0);var h=parseFloat(d[1])+c*f;0>h&&(h=0);var i=g+" "+h+" "+d[2]+" "+d[3];this.element.get(0).setAttribute("viewBox",i),this._trigger("drag",null,{viewBox:i}),a.touches?(this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY):(this.startX=a.clientX,this.startY=a.clientY)}},_getViewBox:function(){return this.element.get(0).getAttribute("viewBox").split(" ")},_create:function(){this.masterViewBox=this._getViewBox(),this._setZoomLevels(),this._registerEvents()},refresh:function(){var a,c=this._getViewBox(),d=parseFloat(c[2]),e=parseFloat(c[3]);for(var f in this.viewBoxDims){var g=this.viewBoxDims[f];if(d>g.width&&e>g.height){a=f-1;break}}if(a===b?a=this.viewBoxDims.length-1:0>a&&(a=0),a===this.curZoomIndex)return this;var h=a>this.curZoomIndex?"in":"out";this.curZoomIndex=a;var i={zoomLevel:this.zoomLevels[this.curZoomIndex],x:c[0],y:c[1],width:d,height:e,direction:h};this._trigger("beforezoom",null,i),this._trigger("afterzoom",null,i)},zoom:function(a){a=a.toLowerCase();var b=this._getViewBox();if(this._trigger("beforezoom",null,{zoomLevel:this.zoomLevels[this.curZoomIndex],x:parseFloat(b[0]),y:parseFloat(b[1]),width:parseFloat(b[2]),height:parseFloat(b[3]),direction:a}),"in"===a&&this.curZoomIndex===this.zoomLevels.length-1)return!1;if("out"===a&&0===this.curZoomIndex)return!1;"in"===a?this.curZoomIndex++:this.curZoomIndex--;var c=this.viewBoxDims[this.curZoomIndex],d=parseFloat(b[0])+parseFloat((parseFloat(b[2])-parseFloat(c.width))/2);0>d?d=0:d+parseFloat(c.width)>parseFloat(this.masterViewBox[2])&&(d=parseFloat(this.masterViewBox[2])-parseFloat(c.width));var e=parseFloat(b[1])+parseFloat((parseFloat(b[3])-parseFloat(c.height))/2);return 0>e?e=0:e+parseFloat(c.height)>parseFloat(this.masterViewBox[3])&&(e=parseFloat(this.masterViewBox[3])-parseFloat(c.height)),this.element.get(0).setAttribute("viewBox",d+" "+e+" "+c.width+" "+c.height),this._trigger("afterzoom",null,{zoomLevel:this.zoomLevels[this.curZoomIndex],x:d,y:e,width:c.width,height:c.height,direction:a}),this}})}(jQuery);